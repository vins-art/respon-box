<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Respon Box</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --blue:#4aa3df;
  --blue-soft:#eaf4fb;
  --white:#ffffff;
  --gray:#666;
}
*{
  box-sizing:border-box;
  font-family:Arial, Helvetica, sans-serif;
}
body{
  margin:0;
  background:var(--blue-soft);
}
.container{
  max-width:1000px;
  margin:auto;
  padding:20px;
}
.card{
  background:var(--white);
  border-radius:12px;
  padding:20px;
  box-shadow:0 4px 12px rgba(0,0,0,.05);
  margin-bottom:20px;
}
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
h1,h2{
  margin:0 0 10px;
  color:var(--blue);
}
button{
  background:var(--blue);
  color:var(--white);
  border:none;
  padding:10px 16px;
  border-radius:6px;
  cursor:pointer;
}
select,input{
  width:100%;
  padding:10px;
  margin:8px 0 16px;
  border-radius:6px;
  border:1px solid #ccc;
}
.hidden{display:none}
.menu{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
  gap:15px;
}
.menu .card{
  text-align:center;
  cursor:pointer;
}
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:10px;
  border-bottom:1px solid #ddd;
  text-align:left;
}
.badge{
  padding:4px 10px;
  border-radius:12px;
  background:var(--blue-soft);
  color:var(--blue);
  font-size:12px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="container" id="loginPage">
  <div class="card">
    <h1>Respon Box</h1>
    <p>Sistem Pelaporan Fasilitas</p>

    <label>Pilih Peran</label>
    <select id="role" onchange="toggleAuth()">
      <option value="">-- Pilih User --</option>
      <option value="mahasiswa">Mahasiswa</option>
      <option value="admin">Admin</option>
      <option value="dekan">Dekan</option>
    </select>

    <div id="auth" class="hidden">
      <input id="username" placeholder="Username">
      <input id="password" type="password" placeholder="Password">
    </div>

    <button onclick="login()">Masuk</button>
  </div>
</div>

<!-- DASHBOARD -->
<div class="container hidden" id="dashboard">

  <div class="card header">
    <h2 id="title"></h2>
    <button onclick="logout()">Logout</button>
  </div>

  <!-- MENU MAHASISWA -->
  <div class="card hidden" id="menuMahasiswa">
    <h2>Menu Mahasiswa</h2>
    <div class="menu">
      <div class="card" onclick="showForm()">Laporkan Gangguan</div>
      <div class="card" onclick="showStatus()">Status Laporan</div>
    </div>
  </div>

  <!-- MENU ADMIN -->
  <div class="card hidden" id="menuAdmin">
    <h2>Menu Admin / Dekan</h2>
    <div class="menu">
      <div class="card" onclick="showAll()">Semua Laporan</div>
      <div class="card" onclick="hitungSAW()">Prioritas (SAW)</div>
    </div>
  </div>

  <!-- FORM LAPORAN -->
  <div class="card hidden" id="formLaporan">
    <h2>Form Pelaporan</h2>

    <label>Kategori Fasilitas</label>
    <select id="kategori" onchange="ubahFasilitas()">
      <option value="gedung">Fasilitas Gedung</option>
      <option value="kelas">Fasilitas Kelas</option>
    </select>

    <label>Jenis Fasilitas</label>
    <select id="jenis"></select>

    <label>Lokasi</label>
    <input id="lokasi" placeholder="Contoh: Gedung A Lantai 2 / Ruang 203">

    <label>Tingkat Kerusakan</label>
    <select id="kerusakan">
      <option value="1">Ringan</option>
      <option value="2">Sedang</option>
      <option value="3">Berat</option>
    </select>

    <button onclick="kirimLaporan()">Kirim Laporan</button>
  </div>

  <!-- TABEL -->
  <div class="card hidden" id="tabelLaporan">
    <h2>Data Laporan</h2>
    <table>
      <thead>
        <tr>
          <th>Kategori</th>
          <th>Fasilitas</th>
          <th>Lokasi</th>
          <th>Kerusakan</th>
          <th>Status</th>
          <th>Prioritas</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody id="isiTabel"></tbody>
    </table>
  </div>

</div>

<script>
let laporan=[];

const fasilitas={
  gedung:['Lampu','Lift','Listrik','Pintu Otomatis','Eskalator','Mesin Absensi','Palang Parkir'],
  kelas:['Kursi','Proyektor','Lampu','Papan Board']
};

const bobot={kerusakan:0.5, kategori:0.3, waktu:0.2};

function toggleAuth(){
  auth.classList.toggle('hidden', role.value==='mahasiswa'||!role.value);
}

function login(){
  if(!role.value) return alert('Pilih peran');
  if(role.value==='admin' && (username.value!=='admin'||password.value!=='admin123')) return alert('Login admin salah');
  if(role.value==='dekan' && (username.value!=='dekan'||password.value!=='dekan123')) return alert('Login dekan salah');

  loginPage.classList.add('hidden');
  dashboard.classList.remove('hidden');

  title.innerText='Dashboard '+role.value;
  menuMahasiswa.classList.toggle('hidden',role.value!=='mahasiswa');
  menuAdmin.classList.toggle('hidden',role.value==='mahasiswa');

  ubahFasilitas();
}

function logout(){location.reload()}

function ubahFasilitas(){
  jenis.innerHTML='';
  fasilitas[kategori.value].forEach(f=>{
    jenis.innerHTML+=`<option>${f}</option>`;
  });
}

function showForm(){
  formLaporan.classList.remove('hidden');
  tabelLaporan.classList.add('hidden');
}

function showStatus(){
  render();
  tabelLaporan.classList.remove('hidden');
  formLaporan.classList.add('hidden');
}

function showAll(){
  render();
  tabelLaporan.classList.remove('hidden');
}

function kirimLaporan(){
  laporan.push({
    kategori:kategori.value,
    jenis:jenis.value,
    lokasi:lokasi.value,
    kerusakan:Number(kerusakan.value),
    status:'Menunggu',
    waktu:Date.now(),
    skor:0
  });
  alert('Laporan berhasil dikirim');
  lokasi.value='';
  showStatus();
}

function hitungSAW(){
  const maxKer=Math.max(...laporan.map(l=>l.kerusakan));
  const maxKat=2;
  const maxWaktu=Math.max(...laporan.map(l=>l.waktu));

  laporan.forEach(l=>{
    const nKer=l.kerusakan/maxKer;
    const nKat=(l.kategori==='gedung'?2:1)/maxKat;
    const nW=l.waktu/maxWaktu;
    l.skor=(nKer*bobot.kerusakan)+(nKat*bobot.kategori)+(nW*bobot.waktu);
  });

  laporan.sort((a,b)=>b.skor-a.skor);
  render();
}

function ubahStatus(i){
  laporan[i].status = laporan[i].status==='Menunggu'?'Diproses':'Selesai';
  render();
}

function render(){
  isiTabel.innerHTML='';
  laporan.forEach((l,i)=>{
    isiTabel.innerHTML+=`
    <tr>
      <td>${l.kategori}</td>
      <td>${l.jenis}</td>
      <td>${l.lokasi}</td>
      <td>${l.kerusakan}</td>
      <td><span class="badge">${l.status}</span></td>
      <td>${l.skor.toFixed(3)}</td>
      <td>${role.value!=='mahasiswa'?`<button onclick="ubahStatus(${i})">Ubah</button>`:''}</td>
    </tr>`;
  });
}
</script>

</body>
</html>
