<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Respon Box</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root{
  --blue:#4aa3df;
  --blue-soft:#eaf4fb;
  --white:#fff;
}
*{box-sizing:border-box;font-family:Arial}
body{margin:0;background:var(--blue-soft)}
.container{max-width:900px;margin:auto;padding:20px}
.card{
  background:var(--white);
  border-radius:10px;
  padding:20px;
  margin-bottom:20px;
  box-shadow:0 4px 10px rgba(0,0,0,.05)
}
h1,h2{color:var(--blue);margin-top:0}
button{
  background:var(--blue);
  color:white;
  border:none;
  padding:10px 16px;
  border-radius:6px;
  cursor:pointer
}
select,input,textarea{
  width:100%;
  padding:10px;
  margin:8px 0 16px;
  border-radius:6px;
  border:1px solid #ccc
}
.menu{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:15px}
.menu .card{text-align:center;cursor:pointer}
.hidden{display:none}
.alarm{color:red;font-weight:bold}
table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid #ddd;text-align:left}
</style>
</head>

<body>

<div class="container" id="loginPage">
  <div class="card">
    <h1>Respon Box</h1>
    <select id="role">
      <option value="">Pilih User</option>
      <option value="mahasiswa">Mahasiswa</option>
      <option value="admin">Admin</option>
      <option value="dekan">Dekan</option>
    </select>
    <input id="username" placeholder="Username">
    <input id="password" type="password" placeholder="Password">
    <button onclick="login()">Masuk</button>
  </div>
</div>

<div class="container hidden" id="dashboard">
  <div class="card">
    <h2 id="title"></h2>
    <button onclick="logout()">Logout</button>
  </div>

  <!-- MAHASISWA -->
  <div class="card hidden" id="menuMahasiswa">
    <h2>Menu Mahasiswa</h2>
    <div class="menu">
      <div class="card" onclick="showForm()">Laporan Gangguan</div>
      <div class="card" onclick="showStatus()">Status Laporan</div>
    </div>
  </div>

  <!-- ADMIN & DEKAN -->
  <div class="card hidden" id="menuAdmin">
    <h2>Menu Admin / Dekan</h2>
    <button onclick="hitungSAW()">Hitung SAW</button>
    <table>
      <thead>
        <tr>
          <th>!</th>
          <th>Kategori</th>
          <th>Fasilitas</th>
          <th>Lokasi</th>
          <th>Catatan</th>
          <th>Prioritas</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="tabel"></tbody>
    </table>
  </div>

  <!-- FORM LAPORAN -->
  <div class="card hidden" id="formLaporan">
    <h2>Laporan Gangguan</h2>

    <select id="kategori" onchange="loadJenis()">
      <option value="">Kategori Fasilitas</option>
      <option value="gedung">Fasilitas Gedung</option>
      <option value="kelas">Fasilitas Kelas</option>
    </select>

    <select id="jenis"></select>
    <input id="lokasi" placeholder="Lokasi">
    <textarea id="catatan" rows="4" placeholder="Catatan"></textarea>
    <button onclick="kirimLaporan()">Kirim</button>
  </div>

  <!-- STATUS MAHASISWA -->
  <div class="card hidden" id="statusPage">
    <h2>Status Laporan</h2>
    <div id="statusList"></div>
  </div>
</div>

<script>
const akun={
  admin:{u:'admin',p:'admin123'},
  dekan:{u:'dekan',p:'dekan123'}
};

const fasilitas={
  gedung:['Lampu','Lift','Listrik','Pintu Otomatis','Eskalator','Mesin Absensi','Palang Parkir','dll'],
  kelas:['Kursi','Proyektor','Lampu','Papan Board','dll']
};

let laporan=[];

function login(){
  const r=role.value,u=username.value,p=password.value;
  if(r==='admin'&&(u!==akun.admin.u||p!==akun.admin.p))return alert('Admin salah');
  if(r==='dekan'&&(u!==akun.dekan.u||p!==akun.dekan.p))return alert('Dekan salah');

  loginPage.classList.add('hidden');
  dashboard.classList.remove('hidden');
  title.innerText='Dashboard '+r.toUpperCase();

  if(r==='mahasiswa'){
    menuMahasiswa.classList.remove('hidden');
  }else{
    menuAdmin.classList.remove('hidden');
    render();
  }
}

function logout(){location.reload()}

function showForm(){
  formLaporan.classList.remove('hidden');
  statusPage.classList.add('hidden');
}

function loadJenis(){
  jenis.innerHTML='';
  if(!kategori.value)return;
  fasilitas[kategori.value].forEach(f=>{
    jenis.innerHTML+=`<option>${f}</option>`;
  });
}

function kirimLaporan(){
  laporan.push({
    kategori:kategori.value,
    jenis:jenis.value,
    lokasi:lokasi.value,
    catatan:catatan.value,
    waktu:Date.now(),
    skor:0,
    prioritas:'Biasa',
    status:'Menunggu'
  });
  alert('Laporan terkirim');
}

function hitungSAW(){
  const maxCat=Math.max(...laporan.map(l=>l.catatan.length||1));
  const maxTime=Math.max(...laporan.map(l=>l.waktu));
  laporan.forEach(l=>{
    l.skor=(0.4*(l.kategori==='gedung'?1:0.7))
          +(0.4*(l.catatan.length/maxCat))
          +(0.2*(l.waktu/maxTime));
    l.prioritas=l.skor>=0.75?'Tinggi':l.skor>=0.5?'Sedang':'Biasa';
  });
  render();
}

function render(){
  tabel.innerHTML='';
  laporan.forEach((l,i)=>{
    if(role.value==='admin'&&l.prioritas==='Tinggi')return;
    if(role.value==='dekan'&&l.prioritas!=='Tinggi')return;

    tabel.innerHTML+=`
    <tr>
      <td>${l.prioritas==='Tinggi'?'<span class="alarm">â–²</span>':''}</td>
      <td>${l.kategori}</td>
      <td>${l.jenis}</td>
      <td>${l.lokasi}</td>
      <td>${l.catatan}</td>
      <td>${l.prioritas}</td>
      <td>
        <button onclick="ubahStatus(${i})">${l.status}</button>
      </td>
    </tr>`;
  });
}

function ubahStatus(i){
  laporan[i].status=
    laporan[i].status==='Menunggu'?'Diproses':
    laporan[i].status==='Diproses'?'Selesai':'Selesai';
  render();
}

function showStatus(){
  statusPage.classList.remove('hidden');
  formLaporan.classList.add('hidden');
  statusList.innerHTML='';
  laporan.forEach(l=>{
    statusList.innerHTML+=`
      <div class="card">
        <b>${l.jenis}</b><br>
        ${l.lokasi}<br>
        Status: ${l.status}
      </div>`;
  });
}
</script>

</body>
</html>
